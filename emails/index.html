<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Site-89 Mail — Inbox</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  
  <!-- Theme System -->
  <script type="module">
    import { ThemeManager } from '/assets/js/theme.js';
    ThemeManager.init();
  </script>
  
  <script type="module" src="/assets/js/auth.js"></script>
  <style>
    /* Outlook-like layout */
    html, body { height: 100%; }
    body { min-height: 100vh; display:flex; flex-direction:column; }
    main.content { flex: 1 0 auto; display:flex; flex-direction:column; }

    .mail-app { display:flex; gap:1rem; padding:1rem; height: 100%; align-items:stretch; }
    .mail-left { width:420px; display:flex; flex-direction:column; gap:1rem; flex: 0 0 420px; }
    .mail-sidebar { width:100%; background:var(--bg-panel); border-radius:8px; padding:1rem; display:flex; flex-direction:column; }
    .mail-folders { margin-top:1rem; display:flex; flex-direction:column; gap:.5rem }
    .folder { display:flex; justify-content:space-between; align-items:center; padding:.5rem; border-radius:6px; cursor:pointer }
    .folder.active { background: linear-gradient(90deg,var(--accent-mint),var(--accent-teal)); color:#081413; font-weight:700 }
    .compose-btn { display:block; width:100%; padding:.6rem .8rem; border-radius:6px; background:linear-gradient(90deg,var(--accent-mint),var(--accent-teal)); color:#081413; font-weight:700; border:none; cursor:pointer }

    .mail-list { width:100%; background:var(--bg-panel); border-radius:8px; overflow:auto; flex:1 1 auto; }
    .mail-list .search { padding: .8rem; border-bottom:1px solid rgba(255,255,255,0.02); }
    .message-item { padding:.8rem .9rem; border-bottom:1px solid rgba(255,255,255,0.02); display:flex; gap:.6rem; align-items:flex-start; cursor:pointer; transition: background-color 0.2s; }
    .message-item:hover { background: rgba(255,255,255,0.03); }
    .message-item.unread { background: rgba(78,250,170,0.08); border-left: 3px solid var(--accent-mint); padding-left: calc(.9rem - 3px); }
    .message-item.unread .subject { color: var(--accent-mint); font-weight: 700; }
    .message-item .meta { flex:1; }
    .message-item .subject { font-weight:700; }
    .message-item .snippet { color:var(--text-light); opacity:.86; font-size:0.95rem }

    .mail-main { flex:1 1 auto; display:flex; align-items:stretch; }
    .mail-view { flex:1 1 0; background:var(--bg-panel); border-radius:8px; padding:1rem; display:flex; flex-direction:column; overflow:auto; min-width:560px; max-width:1200px; margin:0 auto; }
    .mail-view .controls { display:flex; gap:.5rem; margin-bottom:1rem }
    .mail-view .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:.6rem }
    .mail-view .content { background:rgba(255,255,255,0.02); padding:1rem; border-radius:8px; flex:1; overflow:auto }

    /* Compose modal */
    .compose-modal { position:fixed; left:24px; bottom:24px; right:auto; width:640px; background:var(--bg-card); border:1px solid rgba(78,250,170,0.04); border-radius:8px; box-shadow: 0 12px 36px rgba(0,0,0,0.5); z-index:5000; }
    .compose-modal header { padding:0.8rem 1rem; border-bottom:1px solid rgba(255,255,255,0.02); display:flex; justify-content:space-between }
    .compose-modal .body { padding:1rem }
    .compose-modal input, .compose-modal textarea { width:100%; padding:.6rem; margin-bottom:.6rem; border-radius:6px; border:1px solid #333; background:#111; color:var(--text-light) }
    .compose-suggestions { position:absolute; background:var(--bg-card); border:1px solid rgba(78,250,170,0.2); border-radius:6px; max-height:200px; overflow-y:auto; z-index:1000; width:calc(100% - 2rem); display:none; }
    .compose-suggestions div { padding:.5rem .8rem; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.05); }
    .compose-suggestions div:hover { background:rgba(78,250,170,0.1); }

    @media (max-width: 1000px){ .mail-list{display:none} .mail-sidebar{display:none} .mail-left{display:none} .mail-app{padding:.6rem} .compose-modal{left:8px;right:8px;width:auto} .mail-view{min-width:unset} }
  </style>
</head>
<body>
  <div data-include="/components/header.html"></div>
  <div data-include="/components/navbar.html"></div>

  <main class="content">
    <section class="mail-app">
      <div class="mail-left">
        <aside class="mail-sidebar">
          <button class="compose-btn" id="composeBtn">Compose</button>
          <div class="mail-info" style="margin-top:.8rem;font-size:.95rem;color:var(--text-light);opacity:.9" id="myAddress">Signed in as — <em>loading…</em></div>

          <div class="mail-folders" id="folderList">
            <div class="folder active" data-folder="inbox">Inbox <span id="countInbox">0</span></div>
            <div class="folder" data-folder="drafts">Drafts <span id="countDrafts">0</span></div>
            <div class="folder" data-folder="sent">Sent <span id="countSent">0</span></div>
            <div class="folder" data-folder="trash">Trash <span id="countTrash">0</span></div>
          </div>
        </aside>

        <section class="mail-list">
          <div class="search"><input id="mailSearch" placeholder="Search messages…" style="width:100%;padding:.6rem;border-radius:6px;border:1px solid #333;background:#0f0f10;color:var(--text-light)"></div>
          <div id="messagesContainer"></div>
        </section>
      </div>

      <div class="mail-main">
        <section class="mail-view">
        <div class="controls">
          <button id="btnReply" class="btn-secondary btn-icon" title="Reply"><i class="fa-solid fa-reply"></i><span class="label">Reply</span></button>
          <button id="btnForward" class="btn-secondary btn-icon" title="Forward"><i class="fa-solid fa-share-from-square"></i><span class="label">Forward</span></button>
          <button id="btnDelete" class="btn-secondary btn-icon" title="Delete"><i class="fa-solid fa-trash"></i><span class="label">Delete</span></button>
          <div style="flex:1"></div>
          <div id="mailMeta" style="color:var(--text-light);opacity:.8" class="kv"><div class="label">Date:</div><div class="value" id="mailDate">&mdash;</div></div>
        </div>

        <div class="header">
          <h2 id="mailSubject">Select a message</h2>
          <div id="mailSender" style="color:var(--text-light);opacity:.9"></div>
        </div>
        <div class="content" id="mailContent">Use the left column to pick a message — messages load from the server (or local demo data).</div>
      </section>
      </div>
    </section>
  </main>

  <div data-include="/components/footer.html"></div>

  <!-- Compose Modal (hidden by default) -->
  <div id="composeModal" class="compose-modal" style="display:none">
    <header>
      <div>New Message</div>
      <div><button id="composeClose" class="btn-secondary">Close</button></div>
    </header>
    <div class="body">
      <div style="display:flex;gap:.5rem;margin-bottom:.6rem">
        <select id="composeSendAs" style="flex:1;padding:.6rem;border-radius:6px;border:1px solid #333;background:#111;color:var(--text-light)">
          <option value="">Send as personal account</option>
        </select>
      </div>
      <div style="position:relative">
        <input id="composeTo" placeholder="To (comma-separated addresses)" autocomplete="off">
        <div id="composeSuggestions" class="compose-suggestions"></div>
      </div>
      <input id="composeSubject" placeholder="Subject">
      <textarea id="composeBody" placeholder="Message body..."></textarea>
      <div style="display:flex;gap:.5rem;justify-content:flex-end">
        <button id="saveDraftBtn" class="btn-secondary">Save Draft</button>
        <button id="sendBtn" class="btn-primary">Send</button>
      </div>
    </div>
  </div>

  <script src="/assets/js/include.js"></script>
  <script type="module" src="/assets/js/emails.js"></script>
</body>
</html>