<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Containment Database â€” Site-89</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <script type="module">
    import { ThemeManager } from '/assets/js/theme.js';
    ThemeManager.init();
  </script>
</head>
<body>
  <div data-include="/components/header.html"></div>
  <div data-include="/components/navbar.html"></div>

  <main class="content">
    <section class="about-box">
      <h1>Containment Database</h1>
      <p>Anomaly files authored by research staff. Creating/editing requires ScD/R&D department or Level 5 clearance. Viewing respects per-file clearance.</p>
    </section>

    <section class="about-box ms-logs">
      <style>
        .ms-header{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-bottom:1rem}
        .ms-title h1{margin:0;font-size:1.5rem}
        .ms-title .ms-sub{margin:0;color:var(--text-light);font-size:.95rem}
        .ms-toolbar{display:flex;align-items:center;gap:.6rem}
        .ms-search{padding:.5rem .7rem;border-radius:6px;border:1px solid rgba(0,0,0,0.06);min-width:220px}
        .ms-btn-new{padding:.45rem .8rem;border-radius:6px;background:var(--accent-mint);color:var(--bg-dark);border:none;font-weight:700;cursor:pointer;transition:all 0.2s}
        .ms-btn-new:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(78,250,170,0.3)}
        .ms-table{width:100%;border-collapse:collapse;margin-top:1rem;background:var(--bg-card);border-radius:8px;overflow:hidden}
        .ms-table thead{background:linear-gradient(90deg,var(--accent-mint),var(--accent-teal));color:#081413;font-weight:700}
        .ms-table th,.ms-table td{padding:.9rem .75rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
        .click-row{display:block;color:inherit;text-decoration:none}
        .pill{display:inline-block;padding:.25rem .5rem;border-radius:6px;font-weight:700;font-size:.85rem}
        .pill.Safe{background:rgba(78,250,170,0.08);color:var(--accent-mint);border:1px solid rgba(78,250,170,0.06)}
        .pill.Euclid{background:rgba(0,124,107,0.07);color:var(--accent-teal);border:1px solid rgba(0,124,107,0.06)}
        .pill.Keter{background:rgba(146,0,0,0.06);color:var(--accent-red);border:1px solid rgba(146,0,0,0.06)}
        .empty{padding:1.2rem;color:var(--text-light)}
        .modal-content{background:var(--bg-card);border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.4);max-width:1100px !important}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid rgba(255,255,255,0.08);background:linear-gradient(135deg, rgba(78,250,170,0.06) 0%, rgba(0,124,107,0.03) 100%)}
        .modal-header h2{margin:0;font-size:1.4rem;font-weight:900}
        .an-form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem}
        .an-form-grid label{display:flex;flex-direction:column;gap:.4rem;font-weight:600;font-size:.9rem}
        .an-form-grid input, .an-form-grid select{padding:.6rem;border:1px solid rgba(255,255,255,0.1);border-radius:6px;background:rgba(255,255,255,0.02);color:inherit;font-size:.95rem;transition:all 0.2s}
        .an-form-grid input:focus, .an-form-grid select:focus{outline:none;border-color:var(--accent-mint);background:rgba(78,250,170,0.04);box-shadow:0 0 8px rgba(78,250,170,0.15)}
        textarea{font-family:var(--font-mono);font-size:.9rem;padding:.6rem;border:1px solid rgba(255,255,255,0.1);border-radius:6px;background:rgba(255,255,255,0.02);color:inherit;resize:vertical;transition:all 0.2s}
        textarea:focus{outline:none;border-color:var(--accent-mint);background:rgba(78,250,170,0.04);box-shadow:0 0 8px rgba(78,250,170,0.15)}
        .preview-card{background:rgba(78,250,170,0.03);border:1px solid rgba(78,250,170,0.08);border-radius:6px;padding:.8rem;overflow-y:auto;font-size:.9rem;line-height:1.6}
        .form-buttons{display:flex;gap:.6rem;align-items:center;margin-top:1.5rem;flex-wrap:wrap;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.08)}
        .btn-primary, .btn-secondary{padding:.6rem 1.2rem;border-radius:6px;border:none;font-weight:700;cursor:pointer;transition:all 0.2s;font-size:.95rem}
        .btn-primary{background:var(--accent-mint);color:var(--bg-dark)}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(78,250,170,0.3)}
        .btn-secondary{background:rgba(78,250,170,0.15);color:var(--accent-mint);border:1px solid rgba(78,250,170,0.3)}
        .btn-secondary:hover{background:rgba(78,250,170,0.25);border-color:var(--accent-mint)}
        #loadExistingBtn{background:rgba(0,212,232,0.2);color:#00d4e8;border:2px solid rgba(0,212,232,0.4);padding:.5rem 1rem;font-size:.9rem;font-weight:700}
        #loadExistingBtn:hover{background:rgba(0,212,232,0.3);border-color:#00d4e8;box-shadow:0 0 12px rgba(0,212,232,0.3)}
        .feedback{margin:0;padding:.5rem .8rem;border-radius:4px;font-size:.9rem;font-weight:600}
        @media (max-width:1024px) {
          .ms-logs { margin: 0 !important; }
        }
        @media (max-width:768px) {
          .ms-header{flex-direction:column;align-items:stretch}
          .ms-toolbar{justify-content:space-between}
          .ms-table th:nth-child(3), .ms-table td:nth-child(3){display:none}
          .ms-search { min-width: 100%; }
          .ms-table th, .ms-table td { padding: 0.6rem 0.5rem; font-size: 0.9rem; }
          .ms-title h1 { font-size: 1.3rem; }
          .ms-title .ms-sub { font-size: 0.85rem; }
        }
        @media (max-width:480px) {
          .ms-logs { padding: 0 !important; }
          .ms-header { gap: 0.5rem; margin-bottom: 0.75rem; }
          .ms-toolbar { flex-direction: column; gap: 0.5rem; }
          .ms-search { min-width: 100%; padding: 0.4rem 0.6rem; }
          .ms-btn-new { width: 100%; }
          .ms-title h1 { font-size: 1.15rem; }
          .ms-table th, .ms-table td { padding: 0.5rem 0.4rem; font-size: 0.8rem; }
          .ms-table th:nth-child(2), .ms-table td:nth-child(2) { display: none; }
          .pill { padding: 0.2rem 0.4rem; font-size: 0.75rem; }
        }
      </style>

      <div class="ms-header">
        <div class="ms-title">
          <h1>Anomalies</h1>
          <p class="ms-sub">Live index sourced from Firestore. Filter by class/risk/disruption, or search by SCP number and text.</p>
        </div>

        <div class="ms-toolbar">
          <input id="anomalySearch" class="ms-search" placeholder="Search anomaliesâ€¦">
          <button id="newAnomalyBtn" class="ms-btn-new" style="display:none">+ New</button>
        </div>
      </div>

      <div id="createModal" class="modal" aria-hidden="true" style="display:none">
        <div class="modal-content" role="dialog" aria-modal="true" style="max-width:1000px;">
          <div class="modal-header">
            <h2>Create / Edit Anomaly</h2>
            <button id="closeModalBtn" class="btn-link" title="Close">âœ•</button>
          </div>

          <form id="anomalyForm" style="padding:1.5rem">
            <div style="background:rgba(0,212,232,0.08);border:1px solid rgba(0,212,232,0.2);border-radius:8px;padding:1rem;margin-bottom:1rem">
              <strong style="color:#00d4e8;display:block;margin-bottom:.5rem">ðŸ’¡ Creating or Editing?</strong>
              <p style="margin:0;font-size:.9rem;color:var(--text-light)">Enter an SCP number and click <strong>ðŸ“‚ Load Existing</strong> to edit an existing anomaly, or fill in all fields to create a new one.</p>
            </div>
            <div class="an-form-grid">
              <label>Item Number (SCP-000)
                <input id="itemNumber" required placeholder="SCP-131">
              </label>
              <label>Nickname (optional)
                <input id="nickname" placeholder="Eye Pods">
              </label>
              <label>Photo URL (optional)
                <input id="photoUrl" placeholder="https://...">
              </label>
              <label>Containment Class
                <select id="containmentClass" required>
                  <option value="">Select</option>
                  <option>Safe</option>
                  <option>Euclid</option>
                  <option>Keter</option>
                  <option>Thaumiel</option>
                  <option>Neutralized</option>
                  <option>Explained</option>
                </select>
              </label>
              <label>Risk Class
                <select id="riskClass" required>
                  <option value="">Select</option>
                  <option>Notice</option>
                  <option>Caution</option>
                  <option>Warning</option>
                  <option>Danger</option>
                  <option>Critical</option>
                </select>
              </label>
              <label>Disruption Class
                <select id="disruptionClass" required>
                  <option value="">Select</option>
                  <option>Dark</option>
                  <option>Vlam</option>
                  <option>Keneq</option>
                  <option>Ekhi</option>
                  <option>Amida</option>
                </select>
              </label>
              <label>Viewing Clearance Required
                <select id="clearanceLevel" required>
                  <option value="">Select</option>
                  <option value="1">Level 1 (Intern)</option>
                  <option value="2">Level 2</option>
                  <option value="3">Level 3</option>
                  <option value="4">Level 4</option>
                  <option value="5">Level 5</option>
                </select>
              </label>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem">
              <div style="display:flex;flex-direction:column;gap:.4rem">
                <label style="font-weight:600;font-size:.9rem">Special Containment Procedures (Markdown)
                  <textarea id="procedures" placeholder="Detail containment procedures..." required style="height:300px;flex:1"></textarea>
                </label>
              </div>
              <div style="display:flex;flex-direction:column;gap:.4rem">
                <label style="font-weight:600;font-size:.9rem">Procedures Preview
                  <div id="proceduresPreview" class="preview-card" style="height:300px;overflow-y:auto"></div>
                </label>
              </div>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem">
              <div style="display:flex;flex-direction:column;gap:.4rem">
                <label style="font-weight:600;font-size:.9rem">Description (Markdown)
                  <textarea id="description" placeholder="Describe the anomaly..." required style="height:300px;flex:1"></textarea>
                </label>
              </div>
              <div style="display:flex;flex-direction:column;gap:.4rem">
                <label style="font-weight:600;font-size:.9rem">Description Preview
                  <div id="descriptionPreview" class="preview-card" style="height:300px;overflow-y:auto"></div>
                </label>
              </div>
            </div>

            <div style="display:flex;gap:.6rem;align-items:center;margin-top:1rem;flex-wrap:wrap;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.08)">
              <button class="btn-primary" type="submit">Save Anomaly</button>
              <button class="btn-secondary" type="button" id="loadExistingBtn">ðŸ“‚ Load Existing</button>
              <p id="formStatus" class="feedback"></p>
            </div>
          </form>
        </div>
      </div>

      <h2 style="margin-top:1rem">Entries</h2>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.5rem">
        <select id="classFilter">
          <option value="all">All classes</option>
          <option>Safe</option>
          <option>Euclid</option>
          <option>Keter</option>
          <option>Thaumiel</option>
          <option>Neutralized</option>
          <option>Explained</option>
        </select>
        <select id="riskFilter">
          <option value="all">All risk</option>
          <option>Notice</option>
          <option>Caution</option>
          <option>Warning</option>
          <option>Danger</option>
          <option>Critical</option>
        </select>
        <select id="disruptionFilter">
          <option value="all">All disruption</option>
          <option>Dark</option>
          <option>Vlam</option>
          <option>Keneq</option>
          <option>Ekhi</option>
          <option>Amida</option>
        </select>
      </div>

      <table class="ms-table" aria-describedby="anomaliesDesc">
        <thead>
          <tr><th style="width:140px">Item</th><th style="width:140px">Containment</th><th style="width:140px">Risk</th><th style="width:140px">Disruption</th><th>Nickname</th></tr>
        </thead>
        <tbody id="anomalyTableBody">
          <tr><td colspan="5" class="empty">Loadingâ€¦</td></tr>
        </tbody>
      </table>
      <div id="anomaliesDesc" style="display:none">Click any anomaly to view.</div>
    </section>
  </main>

  <div data-include="/components/footer.html"></div>

  <script src="/assets/js/include.js"></script>
  <script type="module" src="/assets/js/auth.js"></script>
  <script type="module" src="/assets/js/anomalyIndex.js"></script>
</body>
</html>
