<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IA Portal — Site-89</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Roboto:wght@300;400,500&family=Roboto+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Theme System -->
  <script type="module">
    import { ThemeManager } from '/assets/js/theme.js';
    ThemeManager.init();
  </script>

  <style>
    .page-hero { padding: 2.5rem 1rem; text-align:center; background: linear-gradient(90deg, rgba(78,250,170,0.04), transparent); border-bottom: 1px solid rgba(78,250,170,0.03); }
    .page-hero .hero-title { font-family: var(--font-head); font-size: 2rem; color: var(--accent-mint); margin-bottom: 0.35rem; }
    .page-hero .hero-sub { color: var(--text-light); opacity: 0.9; }

    .portal-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:1.5rem; margin-top:1.5rem; }
    .portal-card { background: var(--bg-card); border: 1px solid rgba(78,250,170,0.04); padding: 1.5rem; border-radius: 8px; }
    .portal-card h3 { margin:0 0 0.8rem 0; color: var(--accent-mint); font-size:1.2rem; }
    .portal-card p { margin:0; color: var(--text-light); line-height:1.6; opacity:0.92; }
    .portal-card ul { margin:0.8rem 0 0 0; padding-left:1.5rem; }

    .access-denied { text-align:center; padding:3rem; color:var(--text-light); }
    .access-denied i { font-size:3rem; opacity:0.5; margin-bottom:1rem; display:block; }
  </style>
</head>
<body>
  <div data-include="/components/header.html"></div>
  <div data-include="/components/navbar.html"></div>

  <section class="page-hero">
    <div class="hero-title">Internal Affairs Portal</div>
    <div class="hero-sub">Classified operations and intelligence briefings — IA Only</div>
  </section>

  <section class="content">
    <div id="accessDenied" class="access-denied" style="display:none;">
      <i class="fas fa-lock"></i>
      <h2>Access Denied</h2>
      <p>This portal is restricted to Internal Affairs personnel only.</p>
    </div>

    <div id="portalContent" style="display:none;">
      <div class="portal-grid">
        <div class="portal-card">
          <h3><i class="fa-solid fa-folder-open" style="color:var(--accent-teal);margin-right:0.5rem;"></i>Intelligence Archives</h3>
          <p>Classified intelligence briefings, asset locations, and ongoing investigation files.</p>
          <a href="https://drive.google.com/drive/u/0/folders/1placeholder" target="_blank" style="display:inline-block;margin-top:1rem;color:var(--accent-teal);font-weight:600;text-decoration:none;">Access Archives →</a>
        </div>

        <div class="portal-card">
          <h3><i class="fa-solid fa-shield" style="color:var(--accent-teal);margin-right:0.5rem;"></i>Operations Log</h3>
          <p>Covert operations database, threat assessments, and tactical briefings for active cases.</p>
          <a href="https://docs.google.com/spreadsheets/d/1placeholder" target="_blank" style="display:inline-block;margin-top:1rem;color:var(--accent-teal);font-weight:600;text-decoration:none;">View Operations →</a>
        </div>

        <div class="portal-card">
          <h3><i class="fa-solid fa-users" style="color:var(--accent-teal);margin-right:0.5rem;"></i>Asset Management</h3>
          <p>Personnel assets, informants, and external contact logs maintained by Internal Affairs.</p>
          <a href="https://docs.google.com/document/d/1placeholder" target="_blank" style="display:inline-block;margin-top:1rem;color:var(--accent-teal);font-weight:600;text-decoration:none;">View Assets →</a>
        </div>

        <div class="portal-card">
          <h3><i class="fa-solid fa-file-contract" style="color:var(--accent-teal);margin-right:0.5rem;"></i>Case Files</h3>
          <p>Active and closed investigation case files with evidence and conclusion reports.</p>
          <a href="https://drive.google.com/drive/u/0/folders/1placeholder" target="_blank" style="display:inline-block;margin-top:1rem;color:var(--accent-teal);font-weight:600;text-decoration:none;">Browse Cases →</a>
        </div>
      </div>
    </div>
  </section>

  <div data-include="/components/footer.html"></div>

  <script src="/assets/js/include.js"></script>
  <script type="module" src="/assets/js/auth.js"></script>

  <script type="module" src="/assets/js/auth.js"></script>

  <script type="module">
    import { app, auth } from "/assets/js/auth.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const db = getFirestore(app);

    const accessDenied = document.getElementById('accessDenied');
    const portalContent = document.getElementById('portalContent');

    // Check if user is IA
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        accessDenied.style.display = 'block';
        return;
      }

      try {
        const q = query(collection(db, 'characters'), where('linkedUID', '==', user.uid));
        const charSnap = await getDocs(q);

        let hasAccess = false;
        charSnap.forEach(doc => {
          const char = doc.data();
          const dept = (char.department || '').toUpperCase();
          if (dept.includes('IA') || dept.includes('INTERNAL AFFAIRS')) {
            hasAccess = true;
          }
        });

        if (!hasAccess) {
          accessDenied.style.display = 'block';
          return;
        }

        portalContent.style.display = 'block';
      } catch (err) {
        console.error('Access check error:', err);
        accessDenied.style.display = 'block';
      }
    });
  </script>

</body>
</html>
