<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="/assets/js/secure-access.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="required-clearance" content="1">
  <title>Incident Reports — Site-89</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <!-- Theme System -->
  <script type="module">
    import { ThemeManager } from '/assets/js/theme.js';
    ThemeManager.init();
  </script>
</head>
<body>
  <div data-include="/components/header.html"></div>
  <div data-include="/components/navbar.html"></div>

  <main class="content">
    <section class="about-box ms-logs">
      <style>
        /* M365-styled header/table for incident reports */
        .ms-header{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-bottom:1rem}
        .ms-title h1{margin:0;font-size:1.5rem}
        .ms-title .ms-sub{margin:0;color:var(--text-light);font-size:.95rem}
        .ms-toolbar{display:flex;align-items:center;gap:.6rem}
        .ms-search{padding:.5rem .7rem;border-radius:6px;border:1px solid rgba(0,0,0,0.06);min-width:220px}
        .ms-btn-new{padding:.45rem .8rem;border-radius:6px;background:var(--accent-mint);color:var(--bg-dark);border:none}
        .ms-table{width:100%;border-collapse:collapse;margin-top:1rem;background:var(--bg-card);border-radius:8px;overflow:hidden}
        .ms-table thead{background:linear-gradient(90deg,var(--accent-mint),var(--accent-teal));color:#081413;font-weight:700}
        .ms-table th,.ms-table td{padding:.9rem .75rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
        .click-row{display:block;color:inherit;text-decoration:none}
        .pill{display:inline-block;padding:.25rem .5rem;border-radius:6px;font-weight:700;font-size:.85rem}
        .pill.Safe{background:rgba(78,250,170,0.08);color:var(--accent-mint);border:1px solid rgba(78,250,170,0.06)}
        .pill.Euclid{background:rgba(0,124,107,0.07);color:var(--accent-teal);border:1px solid rgba(0,124,107,0.06)}
        .pill.Keter{background:rgba(146,0,0,0.06);color:var(--accent-red);border:1px solid rgba(146,0,0,0.06)}
        .empty{padding:1.2rem;color:var(--text-light)}

        .view-modal{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.55);z-index:1800}
        .view-modal[aria-hidden="false"]{display:flex}
        .view-modal .modal-box{background:var(--bg-card);padding:1.2rem;border-radius:10px;max-width:900px;width:96%;border:1px solid rgba(255,255,255,0.03)}
        .view-modal .meta{color:var(--text-light);opacity:.9;margin-top:.4rem}

        @media (max-width:720px){ .ms-header{flex-direction:column;align-items:stretch}.ms-toolbar{justify-content:space-between} .ms-table th:nth-child(2), .ms-table td:nth-child(2){display:none} }
      </style>

      <div class="ms-header">
        <div class="ms-title">
          <h1>Incident Reports</h1>
          <p class="ms-sub">Logged incident reports — click any title to open the full report. Anyone with ScD or clearance ≥ 1 can view; creation requires ScD or clearance ≥ 3.</p>
        </div>

        <div class="ms-toolbar">
          <input id="incidentSearch" class="ms-search" placeholder="Search incidents by title or tags…">
          <button id="newIncidentBtn" class="ms-btn-new" style="display:none">+ New</button>
        </div>
      </div>

      <h2 style="margin-top:1rem">Entries</h2>
      <table class="ms-table" aria-describedby="incidentDesc">
        <thead>
          <tr><th style="width:1px">Title</th><th>Tags</th></tr>
        </thead>
        <tbody id="incTableBody">
          <tr><td colspan="2" class="empty">Loading…</td></tr>
        </tbody>
      </table>
      <div id="incidentDesc" style="display:none">Click any title to view the full incident report.</div>

      <!-- View modal -->
      <div id="viewIncidentModal" class="view-modal" aria-hidden="true">
        <div class="modal-box" role="dialog" aria-modal="true">
          <div style="display:flex;justify-content:space-between;align-items:center"><h2 id="viewIncidentTitle">Title</h2><button id="viewIncidentClose" class="btn-link">✕</button></div>
          <div id="viewIncidentMeta" class="meta"></div>
          <div id="viewIncidentBody" style="margin-top:.6rem"></div>
        </div>
      </div>

      <!-- Create modal (same pattern as research logs) -->
      <div id="createIncidentModal" class="modal" aria-hidden="true" style="display:none">
        <div class="modal-content" role="dialog" aria-modal="true">
          <div class="modal-header">
            <h2>Create New Incident Report</h2>
            <button id="closeIncidentModal" class="btn-link" title="Close">✕</button>
          </div>

          <form id="createIncidentForm">
            <label>Title <input id="incTitle" placeholder="Title" required></label>
            <label>Tags <input id="incTags" placeholder="Tags (comma separated)"></label>
            <label>Document Link <input id="incDocUrl" placeholder="Google Doc URL (shareable link)" required></label>
            <div style="display:flex;gap:.5rem;margin-top:.6rem"><button id="createIncidentBtn" class="btn-primary" type="submit">Create</button><button id="cancelIncidentBtn" class="btn-secondary" type="button">Cancel</button></div>
            <p id="incFeedback" class="feedback"></p>
          </form>
        </div>
      </div>

    </section>
  </main>

  <div data-include="/components/footer.html"></div>

  <script src="/assets/js/include.js"></script>
  <script type="module" src="/assets/js/auth.js"></script>
  <script type="module" src="/assets/js/incidentReports.js"></script>
</body>
</html>